<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.grgbanking.counter.iam.dao.SysMenuDao">

    <resultMap type="com.grgbanking.counter.iam.entity.SysMenuEntity" id="sysMenuMap">
        <result property="id" column="ID"/>
        <result property="parentCode" column="PARENT_CODE"/>
        <result property="menuCode" column="MENU_CODE"/>
        <result property="menuPath" column="MENU_PATH"/>
        <result property="appType" column="APP_TYPE"/>
        <result property="type" column="TYPE"/>
        <result property="name" column="NAME"/>
        <result property="i18nCode" column="I18N_CODE"/>
        <result property="host" column="HOST"/>
        <result property="port" column="PORT"/>
        <result property="path" column="PATH"/>
        <result property="icon" column="ICON"/>
        <result property="orderNum" column="ORDER_NUM"/>
        <result property="description" column="DESCRIPTION"/>
        <result property="isEnabled" column="IS_ENABLED"/>
        <result property="createdBy" column="CREATED_BY"/>
        <result property="creationDate" column="CREATION_DATE"/>
        <result property="lastUpdatedBy" column="LAST_UPDATED_BY"/>
        <result property="lastUpdateDate" column="LAST_UPDATE_DATE"/>
        <result property="operationId" column="OPERATION_ID"/>
    </resultMap>

    <select id="getMenuPathsByParent" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT
        MAX (m.MENU_PATH)
        FROM
        SYS_MENU m
        WHERE
        m.MENU_PATH LIKE #{path,jdbcType=VARCHAR}
    </select>

    <select id="getAddAuthorityList" parameterType="java.lang.String" resultType="com.grgbanking.counter.iam.api.vo.SysMenuVo">
         SELECT ma.ID as authorityId,sa.AUTHORITY as authority ,m.* FROM SYS_MENU m
        left join SYS_MENU_AUTHORITY ma on m.ID = ma.MENU_ID
        left join SYS_AUTHORITY  sa on sa.ID = ma.AUTHORITY_ID
         <where>
             <if test="appType != null and appType != ''">
                AND m.APP_TYPE = #{appType}
             </if>
             <if test="name != null and name != ''">
               AND m.NAME like CONCAT('%',CONCAT(#{name},'%'))
             </if>
             <if test="type != null and type != ''">
               AND m.TYPE = #{type}
             </if>
             <if test="isEnabled != null and isEnabled != ''">
               AND m.IS_ENABLED = #{isEnabled}
             </if>
         </where> order by m.ORDER_NUM
    </select>


    <select id="getMenuListByUserId"  resultType="com.grgbanking.counter.iam.entity.SysMenuEntity">
        select distinct m.* from SYS_USER u
        inner join SYS_ROLE_USER ru on u.ID = ru.USER_ID
		inner join SYS_ROLE r on r.ID = ru.ROLE_ID
	    inner join SYS_ROLE_MENU rm on rm.ROLE_ID = r.ID
	    inner join SYS_MENU m on m.ID = rm.MENU_ID
		 where u.ID = #{userId} and rm.IS_ENABLED = #{isEnabled} and rm.IS_LEADER = #{isLeader} and m.IS_ENABLED = #{isEnabled}
    </select>

</mapper>
