<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.grgbanking.counter.iam.dao.SysAuthorityDao">

    <resultMap type="com.grgbanking.counter.iam.entity.SysAuthorityEntity" id="sysAuthorityMap">
        <result property="id" column="ID"/>
        <result property="authority" column="AUTHORITY"/>
        <result property="appName" column="APP_NAME"/>
        <result property="appDesc" column="APP_DESC"/>
        <result property="className" column="CLASS_NAME"/>
        <result property="methodName" column="METHOD_NAME"/>
        <result property="fullMethodName" column="FULL_METHOD_NAME"/>
        <result property="moduleName" column="MODULE_NAME"/>
        <result property="moduleDesc" column="MODULE_DESC"/>
        <result property="description" column="DESCRIPTION"/>
        <result property="isEnabled" column="IS_ENABLED"/>
        <result property="createdBy" column="CREATED_BY"/>
        <result property="creationDate" column="CREATION_DATE"/>
        <result property="lastUpdatedBy" column="LAST_UPDATED_BY"/>
        <result property="lastUpdateDate" column="LAST_UPDATE_DATE"/>
        <result property="operationId" column="OPERATION_ID"/>
    </resultMap>

    <select id="getAuthorityByRoleIds" parameterType="list" resultMap="sysAuthorityMap">
        select
        a.*
        from sys_authority a
        inner join sys_menu_authority ma on a.ID = ma.AUTHORITY_ID
        inner join sys_menu m on m.MENU_ID = ma.MENU_ID
        inner join sys_role_menu rm on m.MENU_ID = rm.MENU_ID
        where rm.ROLE_ID in
        <foreach item="item" collection="list" separator="," open="(" close=")" index="">
            #{item}
        </foreach>
    </select>

    <select id="getAuthorityListByMenuId" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT
        DISTINCT sa.AUTHORITY
        FROM
        sys_authority sa
        INNER JOIN SYS_MENU_AUTHORITY sma ON sma.AUTHORITY_ID = sa.ID
        <where>
            sma.MENU_ID=#{menuId}
        </where>
    </select>

    <select id="getAuthorityByUserId" resultType="com.grgbanking.counter.iam.entity.SysAuthorityEntity">
        SELECT
          DISTINCT auth.*
        FROM
          SYS_MENU menu
        INNER JOIN SYS_ROLE_MENU roleMenu      ON menu.ID = roleMenu.MENU_ID
        INNER JOIN SYS_MENU_AUTHORITY menuAuth ON menu.ID = menuAuth.MENU_ID
        INNER JOIN SYS_AUTHORITY auth          ON menuAuth.AUTHORITY_ID = auth.ID
        INNER JOIN SYS_ROLE_USER roleUser      ON roleMenu.ROLE_ID = roleUser.ROLE_ID
        WHERE
          roleUser.USER_ID = #{userId} AND auth.IS_ENABLED = '1'
        <if test="isEnabled != null and isEnabled != ''">
          and menu.IS_ENABLED = #{isEnabled}
        </if>
    </select>

</mapper>